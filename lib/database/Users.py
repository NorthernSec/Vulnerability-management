#!/usr/bin/env python3.3
# -*- coding: utf-8 -*-
#
# Interface for users in the log-in system
#  > Written for MongoDB
#
# Copyright (c) 2015 	Pieter-Jan Moreels
#
# Software is free software released under the "Original BSD license"

# Imports
from passlib.hash import pbkdf2_sha256

from lib.Config import Configuration as conf

# Variables
vmdb = conf.getVMMongoConnection()
users = vmdb.users
rounds = conf.getUserEncryptionRounds()
saltLength = conf.getUserSaltLength()

# Functions
def getUser(name):
  user = users.find_one({"userID":name})
  if not user: return None
  user.pop("password")
  user.pop("_id")
  return user

def checkPass(name, pw):
  user = users.find_one({"userID":name})
  return True if user and pbkdf2_sha256.verify(pw, user['password']) else False

def addUser(user):
  dbUser=user.getDict();
  if not users.find_one({"userID":dbUser["userID"]}):
    dbUser["password"]=pbkdf2_sha256.encrypt(dbUser["password"], rounds=rounds, salt_size=saltLength)
    users.insert(dbUser)
