
# GET Objects
@cursor_wrapped
def getPriorityLevels(cur):
  cur.execute("""SELECT id, min_cvss FROM Ticket_Priorities WHERE min_cvss IS NOT NULL;""")
  # Sort from highest CVSS to lowest
  priorities=sorted(cur.fetchall(),key=lambda x: x[1])
  return priorities

def getTicketsForSystemComponent(component, system, team):
  tickets=getTickets(team, system)
  #for x in tickets:
  #  print(x)
    #tickets.append(getTicket(x[0], x[1], x[2], x[3]))
  return tickets

# UPDATE
@cursor_wrapped
def updatePriority(cur, ticket):
  cvss=ticket.cveInfo["cvss"]
  if ticket.cvss == cvss:
    return
  priority=calculatePriority(ticket)
  #if priority

def calculatePriority(ticket):
  priority=None
  try:
    cvss=float(ticket.cveInfo["cvss"])
  except:
    return None
  # TODO might to reverse loop to fix None problem
  for x in getPriorityLevels():
    if x[1]<cvss:
      priority=x[0]
    else:
      break
  return priority


